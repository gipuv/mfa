name: PR Description Lint

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  check-pr-description:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR description
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const body = context.payload.pull_request.body || "";

            // æ”¯æŒä»»æ„çº§æ ‡é¢˜åŒ¹é…
            function checkRequiredSection(section) {
              const regex = new RegExp(`#++\\s*${section}`, 'i');
              return regex.test(body);
            }

            // æ£€æŸ¥â€œå˜æ›´ç±»å‹â€éƒ¨åˆ†æ˜¯å¦è‡³å°‘å‹¾é€‰ä¸€é¡¹
            function checkCheckboxChecked() {
              const changeTypeSectionMatch = body.match(/#+\s*å˜æ›´ç±»å‹[\s\S]*?(?=#+|$)/i);
              if (!changeTypeSectionMatch) return false;
              const changeTypeSection = changeTypeSectionMatch[0];
              return /- \[[xX]\]/.test(changeTypeSection);
            }

            if (!checkRequiredSection("å˜æ›´æè¿°")) {
              core.setFailed("âŒ å˜æ›´æè¿°ï¼ˆRequiredï¼‰éƒ¨åˆ†æœªå¡«å†™ï¼Œè¯·è¡¥å……ï¼\nâŒ Change Description (Required) section is missing, please complete it!");
            }

            if (!checkRequiredSection("å˜æ›´ç±»å‹")) {
              core.setFailed("âŒ å˜æ›´ç±»å‹éƒ¨åˆ†æœªå¡«å†™ï¼Œè¯·è¡¥å……ï¼\nâŒ Change Type section is missing, please complete it!");
            } else if (!checkCheckboxChecked()) {
              core.setFailed("âŒ è¯·è‡³å°‘å‹¾é€‰ä¸€ä¸ªå˜æ›´ç±»å‹ï¼ˆâœ¨æ–°åŠŸèƒ½/ğŸ›ä¿®å¤/ğŸ§°å…¶ä»–æ›´æ–°ï¼‰\nâŒ Please check at least one change type (âœ¨Feature / ğŸ›Bug Fix / ğŸ§°Others)");
            }

            if (!checkRequiredSection("æ£€æŸ¥æ¸…å•")) {
              core.setFailed("âŒ æ£€æŸ¥æ¸…å•éƒ¨åˆ†æœªå¡«å†™ï¼Œè¯·è¡¥å……ï¼\nâŒ Checklist section is missing, please complete it!");
            }
